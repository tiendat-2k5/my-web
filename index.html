<div style="text-align: center; font-family: sans-serif; background: #222; padding: 20px; border-radius: 15px; color: white;">
  
  <div id="connection-area" style="margin-bottom: 20px;">
    <button onclick="initBluetooth()" style="background-color: #008CBA; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; width: 100%;">
      ğŸ”— Káº¾T Ná»I Vá»šI ÄÃˆN
    </button>
  </div>

  <div style="margin-bottom: 15px;">
    <button onclick="sendHex('ON')" style="background-color: #4CAF50; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; width: 45%;">Báº¬T</button>
    <button onclick="sendHex('OFF')" style="background-color: #f44336; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; width: 45%;">Táº®T</button>
  </div>

  <div style="display: flex; justify-content: space-around;">
    <button onclick="sendHex('STUDY')" style="background-color: #2196F3; color: white; border: none; padding: 15px; border-radius: 50%; cursor: pointer; width: 60px; height: 60px;">ğŸ“–</button>
    <button onclick="sendHex('RELAX')" style="background-color: #9C27B0; color: white; border: none; padding: 15px; border-radius: 50%; cursor: pointer; width: 60px; height: 60px;">ğŸ®</button>
  </div>

  <p id="status" style="color: #00ff00; margin-top: 15px; font-size: 13px;">Sáºµn sÃ ng káº¿t ná»‘i...</p>
</div>

<script>
// LÆ°u biáº¿n toÃ n cá»¥c Ä‘á»ƒ khÃ´ng pháº£i káº¿t ná»‘i láº¡i nhiá»u láº§n
let lampCharacteristic = null;

const SERVICE_UUID = '0000fff0-0000-1000-8000-00805f9b34fb'; 
const CHAR_UUID    = '0000fff3-0000-1000-8000-00805f9b34fb'; 

const HEX_CODES = {
  'ON':    [0x7E, 0x04, 0x01, 0x00], 
  'OFF':   [0x7E, 0x04, 0x00, 0x00], 
  'STUDY': [0x7E, 0x05, 0x03, 0x00, 0xFF, 0x00],
  'RELAX': [0x7E, 0x05, 0x03, 0xFF, 0x00, 0xFF] 
};

async function initBluetooth() {
  const statusEl = document.getElementById('status');
  try {
    statusEl.innerText = "Äang quÃ©t...";
    const device = await navigator.bluetooth.requestDevice({
      filters: [{ services: [SERVICE_UUID.toLowerCase()] }]
    });

    statusEl.innerText = "Äang káº¿t ná»‘i...";
    const server = await device.gatt.connect();
    const service = await server.getPrimaryService(SERVICE_UUID.toLowerCase());
    lampCharacteristic = await service.getCharacteristic(CHAR_UUID.toLowerCase());

    statusEl.innerText = "âœ… ÄÃ£ káº¿t ná»‘i thÃ nh cÃ´ng!";
  } catch (error) {
    statusEl.innerText = "âŒ Lá»—i: " + error.message;
  }
}

async function sendHex(mode) {
  const statusEl = document.getElementById('status');
  if (!lampCharacteristic) {
    statusEl.innerText = "âš ï¸ HÃ£y báº¥m nÃºt Káº¾T Ná»I trÆ°á»›c!";
    return;
  }

  try {
    const command = new Uint8Array(HEX_CODES[mode]);
    // Thá»­ dÃ¹ng writeValueWithoutResponse Ä‘á»ƒ tá»‘c Ä‘á»™ nhanh hÆ¡n
    await lampCharacteristic.writeValueWithoutResponse(command);
    statusEl.innerText = "ÄÃ£ chuyá»ƒn: " + mode;
  } catch (error) {
    statusEl.innerText = "Lá»—i gá»­i lá»‡nh: " + error.message;
  }
}
</script>
