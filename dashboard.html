<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Kens Control Hub</title>
    <style>
        body { margin: 0; padding: 0; background: #111; color: white; font-family: sans-serif; height: 100vh; overflow: hidden; }
        /* Khu v·ª±c hi·ªÉn th·ªã n·ªôi dung */
        .content-area { height: calc(100vh - 70px); overflow-y: auto; padding: 15px; }
        .tab-content { display: none; }
        .active { display: block; }
        
        /* Thanh Tab Bar b√™n d∆∞·ªõi */
        .tab-bar { height: 70px; background: #222; display: flex; justify-content: space-around; align-items: center; border-top: 1px solid #333; }
        .tab-item { text-align: center; color: #888; cursor: pointer; font-size: 12px; }
        .tab-item.active-tab { color: #00ff00; }
        .tab-item i { font-size: 24px; display: block; }
    </style>
</head>
<body>

    <div class="content-area">
        <div id="home" class="tab-content active">
            <div id="clock" style="font-size: 40px; text-align: center; margin-top: 20px;">00:00:00</div>
            <div id="weather" style="text-align: center; color: #aaa;">ƒêang t·∫£i th·ªùi ti·∫øt...</div>
            <div style="margin-top: 20px; height: 300px; border-radius: 15px; overflow: hidden;">
                <iframe src="https://calendar.google.com/calendar/embed?src=tiendatphannguyen@gmail.com&ctz=Asia%2FHo_Chi_Minh" 
                        style="border: 0; width: 100%; height: 100%;" frameborder="0" scrolling="no"></iframe>
            </div>
        </div>

        <div id="control" class="tab-content">
            <h3 style="text-align: center;">Thi·∫øt b·ªã: ƒê√®n neon tr∆∞·ªõc b√†n h·ªçc</h3>
            <button onclick="initBluetooth()" id="connect-btn" style="width: 100%; padding: 15px; background: #008CBA; border: none; border-radius: 10px; color: white;">üîó K·∫æT N·ªêI</button>
            
            <div style="display: flex; justify-content: space-between; margin-top: 20px;">
                <button onclick="sendHex('ON')" style="width: 48%; padding: 20px; background: #4CAF50; border: none; border-radius: 10px; color: white; font-weight: bold;">B·∫¨T</button>
                <button onclick="sendHex('OFF')" style="width: 48%; padding: 20px; background: #f44336; border: none; border-radius: 10px; color: white; font-weight: bold;">T·∫ÆT</button>
            </div>

            <div style="margin-top: 20px; background: #222; padding: 10px; border-radius: 15px; border: 1px solid #444;">
    <p style="margin: 0 0 10px 5px; color: #aaa; font-size: 12px;">üéµ Nh·∫°c Lo-fi / Gaming</p>
    
    <iframe width="100%" height="80" 
            src="https://www.youtube.com/embed/videoseries?list=PLmP7O47PTy-McItNVWpEZxPTzqByUso82&si=tWm8Dz5hA25gRQ9X&autoplay=0&loop=1" 
            title="YouTube Music Player" 
            frameborder="0" 
            allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" 
            allowfullscreen>
    </iframe>
</div>
        </div>
    </div>

    <div class="tab-bar">
        <div class="tab-item active-tab" onclick="switchTab('home', this)">üè†<span>Home</span></div>
        <div class="tab-item" onclick="switchTab('control', this)">‚öôÔ∏è<span>Control</span></div>
    </div>

    <script>
        // 1. Chuy·ªÉn ƒë·ªïi Tab
        function switchTab(tabId, el) {
            document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
            document.querySelectorAll('.tab-item').forEach(t => t.classList.remove('active-tab'));
            document.getElementById(tabId).classList.add('active');
            el.classList.add('active-tab');
        }

        // 2. ƒê·ªìng h·ªì th·ªùi gian th·ª±c
        function updateClock() {
            const now = new Date();
            document.getElementById('clock').innerText = now.toLocaleTimeString('vi-VN');
        }
        setInterval(updateClock, 1000);

        // 3. Bluetooth Logic (G·ªØ nguy√™n m√£ Hex b·∫°n ƒë√£ t√¨m ƒë∆∞·ª£c)
        // ON: [0x7E, 0x04, 0x04, 0xF0, 0x00, 0x01, 0xFF, 0x00, 0xEF]
        // OFF: [0x7E, 0x04, 0x04, 0x00, 0x00, 0x00, 0xFF, 0x00, 0xEF]
      let lampCharacteristic = null;

const SERVICE_UUID = '0000fff0-0000-1000-8000-00805f9b34fb'; 
const CHAR_UUID    = '0000fff3-0000-1000-8000-00805f9b34fb'; 

const HEX_CODES = {
  'ON':    [0x7E, 0x04, 0x04, 0xF0 ,0x00, 0x01, 0xFF, 0x00, 0xEF], 
  'OFF':   [0x7E, 0x04, 0x04, 0x00, 0x00, 0x00, 0xFF, 0x00, 0xEF], 
  'STUDY': [0x7E, 0x05, 0x03, 0x00, 0xFF, 0x00],
  'RELAX': [0x7E, 0x05, 0x03, 0xFF, 0x00, 0xFF] 
};

  async function initBluetooth() {
  const statusEl = document.getElementById('status');
  try {
    statusEl.innerText = "ƒêang qu√©t t·∫•t c·∫£ thi·∫øt b·ªã...";
    
    // THAY ƒê·ªîI T·∫†I ƒê√ÇY: Lo·∫°i b·ªè filters v√† d√πng acceptAllDevices
    const device = await navigator.bluetooth.requestDevice({
      acceptAllDevices: true,
      optionalServices: [SERVICE_UUID.toLowerCase()] // B·∫Øt bu·ªôc ph·∫£i khai b√°o UUID ·ªü ƒë√¢y ƒë·ªÉ sau n√†y truy c·∫≠p ƒë∆∞·ª£c
    });

    statusEl.innerText = "ƒê√£ ch·ªçn: " + device.name + ". ƒêang k·∫øt n·ªëi...";
    const server = await device.gatt.connect();
    
    statusEl.innerText = "ƒêang l·∫•y d·ªãch v·ª•...";
    const service = await server.getPrimaryService(SERVICE_UUID.toLowerCase());
    lampCharacteristic = await service.getCharacteristic(CHAR_UUID.toLowerCase());

    statusEl.innerText = "‚úÖ ƒê√£ k·∫øt n·ªëi th√†nh c√¥ng!";
  } catch (error) {
    statusEl.innerText = "‚ùå L·ªói: " + error.message;
    console.error(error);
  }
}

async function sendHex(mode) {
  const statusEl = document.getElementById('status');
  if (!lampCharacteristic) {
    statusEl.innerText = "‚ö†Ô∏è H√£y b·∫•m n√∫t K·∫æT N·ªêI tr∆∞·ªõc!";
    return;
  }
  const command = new Uint8Array(HEX_CODES[mode]);
  try {
    // Th·ª≠ ph∆∞∆°ng th·ª©c ghi c√≥ x√°c nh·∫≠n (an to√†n h∆°n cho Android 10)
    await lampCharacteristic.writeValueWithResponse(command);
    document.getElementById('status').innerText = "‚úÖ ƒê√£ g·ª≠i l·ªánh " + mode;
  } catch (error) {
    // N·∫øu ƒë√®n ch·ªâ nh·∫≠n l·ªánh kh√¥ng x√°c nh·∫≠n
    await lampCharacteristic.writeValueWithoutResponse(command);
    document.getElementById('status').innerText = "‚úÖ ƒê√£ g·ª≠i (No Response) " + mode;
  }
}
    </script>
</body>
</html>
